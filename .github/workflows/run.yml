name: KOSPI PBR Monitor

on:
  schedule:
    # 한국 시간 오후 6시 5분 (UTC 09:05) 실행
    # KRX의 PBR 데이터가 최종 확정되는 시간을 고려하여 안정적으로 설정했습니다.
    - cron: '5 9 * * 1-5'
  workflow_dispatch: # 필요할 때 언제든 수동으로 실행할 수 있도록 활성화합니다.

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. 리포지토리의 코드를 가상 환경으로 가져옵니다.
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. Python 3.9 환경을 구축합니다.
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. 필요한 라이브러리를 설치합니다.
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # '지수명' 에러 해결의 핵심: -U 옵션으로 pykrx를 항상 최신 버전으로 강제 업데이트합니다.
        pip install -U pykrx requests pandas

    # 4. 모니터링 스크립트를 실행합니다.
    - name: Run script
      env:
        # GitHub Settings -> Secrets에 저장된 환경 변수를 안전하게 불러옵니다.
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: python monitor.py
